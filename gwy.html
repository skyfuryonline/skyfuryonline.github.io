---
layout: gwy_layout
title: "Gwy"
nav-order: 1
---

<!-- 1. æ•°æ®å‡†å¤‡ (Raw Data) -->
<script>
    const quotes = [
        {% for quote in site.data.gwy_quotes %}
        "{{ quote.text }}",
        {% endfor %}
    ];

    // åŸå§‹æ—¥å¿—æ•°æ® (æœªåˆå¹¶)
    const rawLogs = [
        {% for log in site.gwy_logs %}
        {
            date: "{{ log.date | date: '%Y-%m-%d' }}",
            // å…¼å®¹æ—§æ ¼å¼ï¼šå¦‚æœæ²¡é… subjectsï¼Œå°±ç”¨ study_hours + tags
            totalHours: {{ log.study_hours | default: 0 }}, 
            subjects: [
                {% if log.subjects %}
                    {% for sub in log.subjects %}
                    { name: "{{ sub.name }}", hours: {{ sub.hours }} },
                    {% endfor %}
                {% else %}
                    // æ—§æ ¼å¼å›é€€é€»è¾‘: å°† tags è§†ä¸ºç§‘ç›®ï¼Œæ—¶é•¿å¹³å‡åˆ†
                    {% if log.tags %}
                        {% assign tag_count = log.tags.size %}
                        {% assign avg_hour = log.study_hours | divided_by: tag_count %}
                        {% for tag in log.tags %}
                        { name: "{{ tag }}", hours: {{ avg_hour }} },
                        {% endfor %}
                    {% endif %}
                {% endif %}
            ]
        },
        {% endfor %}
    ];

    document.addEventListener('DOMContentLoaded', function() {
        // --- A. æ•°æ®å¤„ç† (æ ¸å¿ƒå‡çº§) ---
        // æˆ‘ä»¬åœ¨è¿™é‡ŒæŠŠ rawLogs è½¬æ¢æˆ studyLogs (æ—¥æœŸ->æ€»æ—¶é•¿) å’Œ subjectStats (ç§‘ç›®->æ€»æ—¶é•¿)
        
        const studyLogs = {}; // { '2026-01-01': 8.5 }
        const subjectStats = {}; // { 'ç”³è®º': 20, 'è¡Œæµ‹': 15 }
        let totalHours = 0;
        let totalDaysSet = new Set(); // ç”¨ Set ç»Ÿè®¡å¤©æ•°ï¼Œè‡ªåŠ¨å»é‡

        rawLogs.forEach(log => {
            // 1. å¤„ç†æ—¥æœŸåˆå¹¶
            // å¦‚æœ subjects å­˜åœ¨ï¼Œé‡æ–°è®¡ç®—è¿™ç¯‡æ—¥å¿—çš„æ€»æ—¶é•¿ï¼ˆè¦†ç›– Front Matter é‡Œçš„ study_hoursï¼Œé˜²æ­¢æ‰‹å†™é”™è¯¯ï¼‰
            let logTotal = log.totalHours;
            if (log.subjects && log.subjects.length > 0) {
                logTotal = log.subjects.reduce((sum, sub) => sum + sub.hours, 0);
            }

            // ç´¯åŠ åˆ°å¯¹åº”æ—¥æœŸ
            studyLogs[log.date] = (studyLogs[log.date] || 0) + logTotal;
            
            // 2. å…¨å±€ç»Ÿè®¡
            if (logTotal > 0) {
                totalHours += logTotal;
                totalDaysSet.add(log.date);
            }

            // 3. ç§‘ç›®ç»Ÿè®¡
            if (log.subjects && log.subjects.length > 0) {
                log.subjects.forEach(sub => {
                    subjectStats[sub.name] = (subjectStats[sub.name] || 0) + sub.hours;
                });
            } else if (log.totalHours > 0) {
                // å¦‚æœæ—¢æ²¡ subjects ä¹Ÿæ²¡ tags (ç½•è§)ï¼Œå½’ä¸º "å…¶ä»–"
                subjectStats['å…¶ä»–'] = (subjectStats['å…¶ä»–'] || 0) + log.totalHours;
            }
        });

        // --- B. éšæœºæ ¼è¨€ ---
        if (quotes.length > 0) {
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            const quoteEl = document.getElementById('daily-quote');
            if(quoteEl) quoteEl.textContent = "â€œ" + randomQuote + "â€";
        }

        // --- C. çƒ­åŠ›å›¾ç”Ÿæˆ ---
        const heatmapContainer = document.getElementById('study-heatmap');
        if(heatmapContainer) {
            const startDate = new Date("2026-01-01");
            const endDate = new Date("2026-12-31");
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                const hours = studyLogs[dateStr] || 0;
                const cell = document.createElement('div');
                cell.classList.add('heatmap-cell');
                
                let level = 0;
                if (hours > 0) level = 1;
                if (hours >= 2) level = 2;
                if (hours >= 4) level = 3;
                if (hours >= 6) level = 4;
                
                cell.classList.add(`level-${level}`);
                cell.title = `${dateStr}: ${hours.toFixed(1)} hrs`; 
                heatmapContainer.appendChild(cell);
            }
        }

        // --- D. ç»Ÿè®¡æ•°æ® UI ---
        // Streak è®¡ç®—
        let currentStreak = 0;
        const todayStr = new Date().toISOString().split('T')[0];
        let checkDate = new Date();
        if (studyLogs[todayStr] > 0) currentStreak = 1;
        checkDate.setDate(checkDate.getDate() - 1);
        while (true) {
            const checkStr = checkDate.toISOString().split('T')[0];
            if (studyLogs[checkStr] > 0) {
                currentStreak++;
                checkDate.setDate(checkDate.getDate() - 1);
            } else { break; }
        }

        document.getElementById('stat-total-hours').textContent = totalHours.toFixed(1);
        document.getElementById('stat-days').textContent = totalDaysSet.size;
        document.getElementById('stat-streak').textContent = currentStreak;

        // --- E. è°ƒç”¨å›¾è¡¨æ¸²æŸ“ (ä¼ é€’å¤„ç†å¥½çš„ subjectStats) ---
        if (typeof renderCharts === 'function') {
            renderCharts(studyLogs, subjectStats);
        }
    });
</script>

<!-- 2. æ—¶é—´è½´å†…å®¹ -->
{% assign logs = site.gwy_logs | sort: 'date' | reverse %}
{% for log in logs %}
<div class="timeline-item">
    <div class="timeline-dot"></div>
    <div class="timeline-date">{{ log.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}</div>
    <div class="timeline-card">
        <h3 class="timeline-title">{{ log.title }}</h3>
        <div class="timeline-meta">
            <!-- æ˜¾ç¤ºå…·ä½“çš„ç§‘ç›®è€—æ—¶ -->
            {% if log.subjects %}
                {% for sub in log.subjects %}
                <span style="margin-right: 10px; background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">
                    {{ sub.name }}: {{ sub.hours }}h
                </span>
                {% endfor %}
            {% else %}
                <span>â±ï¸ å­¦ä¹  {{ log.study_hours }} å°æ—¶</span>
                {% if log.tags %}
                <span style="margin-left: 10px;">ğŸ·ï¸ {{ log.tags | join: ", " }}</span>
                {% endif %}
            {% endif %}
        </div>
        <div class="timeline-content">
            {{ log.content | markdownify }}
        </div>
    </div>
</div>
{% endfor %}
