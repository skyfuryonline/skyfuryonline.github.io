---
layout: gwy_layout
title: "Gwy"
nav-order: 1
---

<!-- 1. æ•°æ®å‡†å¤‡ (Raw Data) -->
<script>
    const quotes = [
        {% for quote in site.data.gwy_quotes %}
        "{{ quote.text }}",
        {% endfor %}
    ];

    const rawLogs = [
        {% for log in site.gwy_logs %}
        {
            date: "{{ log.date | date: '%Y-%m-%d' }}",
            totalHours: {{ log.study_hours | default: 0 }}, 
            subjects: [
                {% if log.subjects %}
                    {% for sub in log.subjects %}
                    { name: "{{ sub.name }}", hours: {{ sub.hours }} },
                    {% endfor %}
                {% else %}
                    {% if log.tags %}
                        {% assign tag_count = log.tags.size %}
                        {% assign avg_hour = log.study_hours | divided_by: tag_count %}
                        {% for tag in log.tags %}
                        { name: "{{ tag }}", hours: {{ avg_hour }} },
                        {% endfor %}
                    {% endif %}
                {% endif %}
            ]
        },
        {% endfor %}
    ];

    document.addEventListener('DOMContentLoaded', function() {
        // --- A. æ•°æ®å¤„ç† ---
        const studyLogs = {}; 
        const subjectStats = {}; 
        let totalHours = 0;
        let totalDaysSet = new Set(); 

        // ç§‘ç›®å½’ä¸€åŒ–æ˜ å°„è¡¨
        const subjectMapping = {
            "èµ„æ–™": "èµ„æ–™åˆ†æ", "èµ„æ–™åˆ†æ": "èµ„æ–™åˆ†æ", "é€Ÿç®—": "èµ„æ–™åˆ†æ",
            "åˆ¤æ–­": "åˆ¤æ–­æ¨ç†", "åˆ¤æ–­æ¨ç†": "åˆ¤æ–­æ¨ç†", "å›¾æ¨": "åˆ¤æ–­æ¨ç†", "å›¾å½¢æ¨ç†": "åˆ¤æ–­æ¨ç†", "é€»è¾‘": "åˆ¤æ–­æ¨ç†", "ç±»æ¯”": "åˆ¤æ–­æ¨ç†", "å®šä¹‰": "åˆ¤æ–­æ¨ç†",
            "è¨€è¯­": "è¨€è¯­ç†è§£", "è¨€è¯­ç†è§£": "è¨€è¯­ç†è§£", "ç‰‡æ®µé˜…è¯»": "è¨€è¯­ç†è§£", "é€‰è¯": "è¨€è¯­ç†è§£", "é€»è¾‘å¡«ç©º": "è¨€è¯­ç†è§£",
            "æ•°é‡": "æ•°é‡å…³ç³»", "æ•°é‡å…³ç³»": "æ•°é‡å…³ç³»", "æ•°å­¦": "æ•°é‡å…³ç³»",
            "å¸¸è¯†": "å¸¸è¯†åˆ¤æ–­", "å¸¸è¯†åˆ¤æ–­": "å¸¸è¯†åˆ¤æ–­",
            "ç”³è®º": "ç”³è®º", "å¤§ä½œæ–‡": "ç”³è®º", "å°é¢˜": "ç”³è®º", "å…¬æ–‡": "ç”³è®º",
            "é¢è¯•": "é¢è¯•", "æ¨¡æ‹Ÿ": "æ¨¡è€ƒ"
        };

        rawLogs.forEach(log => {
            // è¿‡æ»¤æ‰ 2026-01-01 ä¹‹å‰çš„æ—¥å¿—
            if (log.date < "2026-01-01") return;

            let logTotal = log.totalHours;
            if (log.subjects && log.subjects.length > 0) {
                logTotal = log.subjects.reduce((sum, sub) => sum + sub.hours, 0);
            }
            studyLogs[log.date] = (studyLogs[log.date] || 0) + logTotal;
            
            if (logTotal > 0) {
                totalHours += logTotal;
                totalDaysSet.add(log.date);
            }

            if (log.subjects && log.subjects.length > 0) {
                log.subjects.forEach(sub => {
                    const stdName = subjectMapping[sub.name] || "å…¶ä»–";
                    subjectStats[stdName] = (subjectStats[stdName] || 0) + sub.hours;
                });
            } else if (log.totalHours > 0) {
                subjectStats['å…¶ä»–'] = (subjectStats['å…¶ä»–'] || 0) + log.totalHours;
            }
        });

        // --- B. éšæœºæ ¼è¨€ ---
        if (quotes.length > 0) {
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            const quoteEl = document.getElementById('daily-quote');
            if(quoteEl) quoteEl.textContent = "â€œ" + randomQuote + "â€";
        }

        // --- C. åˆå§‹åŒ–æœˆå† (New!) ---
        if (typeof initCalendar === 'function') {
            initCalendar(studyLogs);
        }

        // --- D. ç»Ÿè®¡æ•°æ® UI ---
        let currentStreak = 0;
        const todayStr = new Date().toISOString().split('T')[0];
        let checkDate = new Date();
        if (studyLogs[todayStr] > 0) currentStreak = 1;
        checkDate.setDate(checkDate.getDate() - 1);
        while (true) {
            const checkStr = checkDate.toISOString().split('T')[0];
            if (studyLogs[checkStr] > 0) {
                currentStreak++;
                checkDate.setDate(checkDate.getDate() - 1);
            } else { break; }
        }

        document.getElementById('stat-total-hours').textContent = totalHours.toFixed(1);
        document.getElementById('stat-days').textContent = totalDaysSet.size;
        document.getElementById('stat-streak').textContent = currentStreak;

        // --- E. è°ƒç”¨å›¾è¡¨æ¸²æŸ“ ---
        if (typeof renderCharts === 'function') {
            renderCharts(studyLogs, subjectStats);
        }
    });
</script>

<!-- 2. æ—¶é—´è½´å†…å®¹ -->
{% assign today = site.time | date: "%Y-%m-%d" %}
{% assign all_entries = site.gwy_logs | concat: site.gwy_reports | sort: 'date' | reverse %}

{% for entry in all_entries %}
  {% assign entry_date = entry.date | date: "%Y-%m-%d" %}

  <!-- åªæ˜¾ç¤ºï¼šä»Šå¤©çš„æˆ–è¿‡å»çš„è®°å½• -->
  {% if entry_date <= today %}
    
    {% if entry.is_report %}
      <!-- å‘¨æŠ¥å¡ç‰‡æ ·å¼ -->
      <div class="timeline-item report-item">
          <div class="timeline-dot"></div>
          <div class="timeline-date">{{ entry.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}</div>
          <div class="timeline-card report-card">
              <h3 class="timeline-title">ğŸ‘‘ {{ entry.title }}</h3>
              <div class="timeline-content">
                  {{ entry.content | markdownify }}
              </div>
          </div>
      </div>
    {% else %}
      <!-- æ™®é€šæ—¥è®°å¡ç‰‡ -->
      {% assign total_hours = 0 %}
      {% if entry.subjects %}
        {% for sub in entry.subjects %}
          {% assign total_hours = total_hours | plus: sub.hours %}
        {% endfor %}
      {% else %}
        {% assign total_hours = entry.study_hours | default: 0 %}
      {% endif %}

      {% assign status_class = "level-4" %}
      {% if total_hours == 0 %}{% assign status_class = "alert" %}
      {% elsif total_hours < 2 %}{% assign status_class = "level-1" %}
      {% elsif total_hours < 4 %}{% assign status_class = "level-2" %}
      {% elsif total_hours < 6 %}{% assign status_class = "level-3" %}
      {% endif %}

      <div class="timeline-item {{ status_class }}-item">
          <div class="timeline-dot"></div>
          <div class="timeline-date">{{ entry.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}</div>
          <div class="timeline-card {{ status_class }}-card">
              <h3 class="timeline-title">{{ entry.title }}</h3>
              <div class="timeline-meta">
                  {% if entry.subjects and total_hours > 0 %}
                      {% for sub in entry.subjects %}
                         {% if sub.hours > 0 %}
                          <span style="margin-right: 10px; background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">
                              {{ sub.name }}: {{ sub.hours }}h
                          </span>
                         {% endif %}
                      {% endfor %}
                  {% else %}
                      <span>â±ï¸ å­¦ä¹  {{ total_hours }} å°æ—¶</span>
                  {% endif %}
              </div>
              <div class="timeline-content">
                  {{ entry.content | markdownify }}
              </div>
          </div>
      </div>
    {% endif %}
  {% endif %}
{% endfor %}